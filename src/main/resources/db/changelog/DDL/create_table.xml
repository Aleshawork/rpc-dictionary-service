<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
                xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xmlns:pro="http://www.liquibase.org/xml/ns/pro"
                xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd
                      http://www.liquibase.org/xml/ns/pro
                      http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd">
    <!--
    Generate by Hibernate in create mode:
          drop table if exists message cascade;
          drop table if exists object_type cascade;
          drop table if exists users cascade;
          create sequence hibernate_sequence start 1 increment 1;
          create table message (id int8 not null, code varchar(255), date timestamp, text varchar(255), user_id int8, primary key (id));
          create table object_type (id int8 generated by default as identity, code varchar(255), primary key (id));
          create table users (id int8 generated by default as identity, age int4 not null, name varchar(255), type_id int8, primary key (id));
          create table information (id int8 generated by default as identity, main_information varchar(255), type varchar(255), primary key (id));
          alter table if exists message add constraint FKpdrb79dg3bgym7pydlf9k3p1n foreign key (user_id) references users;
          alter table if exists users add constraint FK2t1bxrgmnitevdj1c17x5nesa foreign key (type_id) references object_type;
      -->

        <changeSet  author="borisov-am"  id="create_object_type">
            <preConditions onFail="MARK_RAN">
                <not>
                    <tableExists tableName="object_type"/>
                </not>
            </preConditions>
            <createTable tableName="object_type">
                <column  name="id"  type="bigint" autoIncrement="true">
                    <constraints  nullable="false"  primaryKey="true"  unique="true"/>
                </column>
                <column  name="code"  type="VARCHAR(60)"/>
            </createTable>
        </changeSet>

        <changeSet  author="borisov-am"  id="create_users">
            <preConditions onFail="MARK_RAN">
                <not>
                    <tableExists tableName="users"/>
                </not>
            </preConditions>
            <createTable tableName="users">
                <column  name="id"  type="bigint" autoIncrement="true">
                    <constraints  nullable="false"  primaryKey="true"  unique="true"/>
                </column>
                <column  name="name"  type="VARCHAR(70)"/>
                <column  name="age"  type="int"/>
                <column  name="type_id"  type="bigint"/>
            </createTable>
            <addForeignKeyConstraint baseTableName="users"
                                     baseColumnNames="id"
                                     constraintName="type_id"
                                     referencedTableName="object_type"
                                     referencedColumnNames="id"/>
        </changeSet>

        <changeSet  author="borisov-am"  id="create_message">
            <preConditions onFail="MARK_RAN">
                <not>
                    <tableExists tableName="message"/>
                </not>
            </preConditions>
            <createTable tableName="message">
                <column  name="id"  type="bigint" autoIncrement="true">
                    <constraints  nullable="false"  primaryKey="true"  unique="true"/>
                </column>
                <column  name="code"  type="VARCHAR(60)"/>
                <column  name="text"  type="VARCHAR(120)"/>
                <column  name="date"  type="timestamp(3)"/>
                <column  name="user_id"  type="bigint"/>
            </createTable>

            <addForeignKeyConstraint baseTableName="message"
                                     baseColumnNames="id"
                                     constraintName="user_id"
                                     referencedTableName="users"
                                     referencedColumnNames="id"/>
        </changeSet>


        <changeSet  author="borisov-am"  id="create_information">
            <preConditions onFail="MARK_RAN">
                <not>
                    <tableExists tableName="information"/>
                </not>
            </preConditions>
            <createTable tableName="information">
                <column  name="id"  type="bigint" autoIncrement="true">
                    <constraints  nullable="false"  primaryKey="true"  unique="true"/>
                </column>
                <column  name="type"  type="VARCHAR(60)"/>
                <column name="main_information" type="VARCHAR(255)"/>
            </createTable>
        </changeSet>


</databaseChangeLog>